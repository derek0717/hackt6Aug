function CustomMarker(e,t,o){this.latlng=e,this.args=o,this.setMap(t)}function getLocation(){navigator.geolocation?navigator.geolocation.getCurrentPosition(showPosition):console.log="Geolocation is not supported by this browser.",console.log("grabbing location")}function showPosition(e){console.log("Latitude: "+e.coords.latitude+" Longitude: "+e.coords.longitude);var t=new google.maps.LatLng(e.coords.latitude,e.coords.longitude),o=new google.maps.Marker({position:t,title:"Hello World!",icon:"images/icon.png"});o.setMap(map),map.panTo(e)}function addPin(e,t){console.log("Add pin: Latitude: "+e+" Longitude: "+t);var o=new google.maps.LatLng(e,t);new CustomMarker(o,map,{pin_id:"123",title:"Red title",message:"this is a message",lat:e,lon:t})}function addPinFromJSON(e){}function showPinMessage(e){var t=$(e).data("title"),o=$(e).data("message"),n=$(e).data("lat"),a=$(e).data("lon");map.panTo(new google.maps.LatLng(n,a)),google.maps.event.addListenerOnce(map,"idle",function(){console.log(t+" "+o),console.log(e)})}function placeMarker(e){new google.maps.Marker({position:e,map:map,icon:"images/icon.png"});map.panTo(e),google.maps.event.addListenerOnce(map,"idle",function(){console.log("this logs after the panTo finishes."),addPinFormPopUp(e.lat(),e.lng())})}function markerClick(e){console.log("click")}function readJsonAndCreateAllPins(e){for(var t=0,o=e.length;t<o;t++)addNewPinFromJSON(e[t])}function initialize(){var e={center:new google.maps.LatLng(22.286918099999998,114.1494163),zoom:15,disableDefaultUI:!0,mapTypeId:google.maps.MapTypeId.ROADMAP};map=new google.maps.Map(document.getElementById("googleMap"),e),google.maps.event.addListener(map,"click",function(e){placeMarker(e.latLng,map)})}function get(e){return new Promise(function(t,o){var n=new XMLHttpRequest;n.open("GET",e),n.onload=function(){200==n.status?t(n.response):o(Error(n.statusText))},n.onerror=function(){o(Error("Network Error"))},n.send()})}function push(e){return new Promise(function(t,o){var n=new XMLHttpRequest;n.open("PUSH",theMainURL+"/addPin"),n.send(e)})}function addtoJSON(){}function toggleFormView(){$("#addPinFormWrap").toggleClass("hide"),$("#formBackground").toggleClass("hide")}function addPinFormPopUp(e,t){toggleFormView(),$("#newPinButton").on("click",function(o){var n=$("#newPinFormTags").val(),a=n.split(","),i={title:$("#newPinFormTitle").val(),message:$("#newPinFormMessage").val(),location:{lat:e,lon:t},tags:a,user_id:"test-user1"};console.log(i),toggleFormView(),push(JSON.stringify(i))})}CustomMarker.prototype=new google.maps.OverlayView,CustomMarker.prototype.draw=function(){var e=this,t=this.div;if(!t){t=this.div=document.createElement("div"),t.className="pin tag1",t.style.position="absolute","undefined"!=typeof e.args.pin_id&&(t.dataset.pin_id=e.args.pin_id),"undefined"!=typeof e.args.title&&(t.dataset.title=e.args.title),"undefined"!=typeof e.args.message&&(t.dataset.message=e.args.message),"undefined"!=typeof e.args.lat&&(t.dataset.lat=e.args.lat),"undefined"!=typeof e.args.lon&&(t.dataset.lon=e.args.lon);var o;"undefined"!=typeof e.args.user_id&&(t.dataset.userIdThing=e.args.user_id),google.maps.event.addDomListener(t,"click",function(e){e.stopPropagation(),showPinMessage(this)}),$(t).html("<div><img src='/images/"+o+".jpg' alt=''></img></div>");var n=this.getPanes();n.overlayImage.appendChild(t)}var a=this.getProjection().fromLatLngToDivPixel(this.latlng);a&&(t.style.left=a.x+"px",t.style.top=a.y+"px")},CustomMarker.prototype.remove=function(){this.div&&(this.div.parentNode.removeChild(this.div),this.div=null)},CustomMarker.prototype.getPosition=function(){return this.latlng};var map,lastAddPin;google.maps.event.addDomListener(window,"load",initialize);var testThePins,testPin1={title:"title1",message:"some text here.",location:{lat:22.283636353214973,lon:114.1349458694458},tags:["A","B","C"],user_id:"user1"},theMainURL="/api";get(theMainURL+"/getPins").then(JSON.parse).then(function(e){testThePins=e,readJsonAndCreateAllPins(e)}),$(document).on("keypress",function(e){switch(e.which){case 112:push(testPin1)}}),$("#formBackground").on("click",function(e){toggleFormView()});